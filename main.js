(()=>{"use strict";function e(e,t,n,o,r,c,u){var i=document.querySelector("#card-template").content.querySelector(".card").cloneNode(!0),a=i.querySelector(".card__image"),l=i.querySelector(".card__delete-button"),s=i.querySelector(".card__like-section_like-button"),d=i.querySelector(".card__like-section_likes-counter");return i.querySelector(".card__title").textContent=e,i.id=o,a.setAttribute("src",t),a.setAttribute("alt","Картинка карточки: "+e),d.textContent=c,s.addEventListener("click",(function(){return r(o)})),l.addEventListener("click",(function(){return n(o)})),a.addEventListener("click",(function(){return u(e,t)})),i}function t(e){document.getElementById(e).querySelector(".card__like-section_like-button").classList.toggle("card__like-section_like-button_is-active")}function n(e){e.classList.toggle("popup_is-opened"),document.addEventListener("keydown",r)}function o(e){e.classList.remove("popup_is-opened"),document.removeEventListener("keydown",r)}function r(e){"Escape"==e.key&&o(document.querySelector(".popup_is-opened"))}function c(e){e.target.closest(".popup__content")||o(document.querySelector(".popup_is-opened"))}function u(e,t){var n=Array.from(t.querySelectorAll(e.inputSelector)),o=t.querySelector(e.submitButtonSelector);n.forEach((function(n){var o=t.querySelector(".".concat(n.id,"-error"));o.classList.remove(e.errorClass),o.textContent="",n.classList.remove(e.inputErrorClass),n.value=""})),a(e,n,o)}function i(e,t,n,o){var r=t.querySelector(".".concat(n.id,"-error"));n.classList.add(e.inputErrorClass),r.classList.add(e.errorClass),r.textContent=o}function a(e,t,n){!function(e){return e.some((function(e){return!e.validity.valid}))}(t)?(n.disabled=!1,n.classList.remove(e.inactiveButtonClass)):(n.disabled=!0,n.classList.add(e.inactiveButtonClass))}var l={baseUrl:"https://nomoreparties.co/v1/wff-cohort-4",headers:{authorization:"c0edb41f-ba4d-40ed-827b-6ec0b8b823cf","Content-Type":"application/json"}};function s(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,o=new Array(t);n<t;n++)o[n]=e[n];return o}var d=document.querySelector(".profile__edit-button"),p=document.querySelector(".profile__add-button"),f=document.querySelector(".profile__avatar_overlay"),_=document.querySelector(".profile__avatar_image"),y=document.querySelector(".profile__title"),m=document.querySelector(".profile__description"),v=document.querySelector(".places__list"),h=document.querySelector(".popup_type_edit"),S=h.querySelector(".popup__close"),b=h.querySelector(".popup__form"),k=b.querySelector(".popup__button"),q=document.querySelector(".popup_type_new-card"),g=q.querySelector(".popup__close"),E=q.querySelector(".popup__form"),L=b.querySelector(".popup__button"),C=document.querySelector(".popup_type_update-avatar"),j=C.querySelector(".popup__close"),x=C.querySelector(".popup__form"),A=x.querySelector(".popup__button"),P=document.querySelector(".popup_type_image"),B=P.querySelector(".popup__caption"),U=P.querySelector(".popup__image"),w=P.querySelector(".popup__close"),I=document.querySelector(".popup_type_delete"),O=I.querySelector(".popup__close"),T=h.querySelector(".popup__input_type_name"),D=h.querySelector(".popup__input_type_description"),N=q.querySelector(".popup__input_type_card-name"),z=q.querySelector(".popup__input_type_url"),J=C.querySelector(".popup__input_type_url"),M={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"};function H(e){v.insertBefore(e,v.firstChild)}function $(e,t){U.src=t,U.alt="Картинка карточки: "+e,B.textContent=e,n(P)}function F(e){I.id=e,n(I)}function G(e){e.reset()}function K(e){var n=document.getElementById(e).querySelector(".card__like-section_likes-counter");document.getElementById(e).querySelector(".card__like-section_like-button_is-active")?function(e){return fetch("".concat(l.baseUrl,"/cards/likes/").concat(e),{method:"DELETE",headers:l.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))}(e).then((function(o){n.textContent=o.likes.length,t(e)})).catch((function(e){console.log(e)})):function(e){return fetch("".concat(l.baseUrl,"/cards/likes/").concat(e),{method:"PUT",headers:l.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))}(e).then((function(o){n.textContent=o.likes.length,t(e)})).catch((function(e){console.log(e)}))}d.addEventListener("click",(function(){u(M,b),T.value=y.textContent,D.value=m.textContent,n(h)})),p.addEventListener("click",(function(){n(q),u(M,E)})),f.addEventListener("click",(function(){n(C),u(M,x)})),S.addEventListener("click",(function(){return o(h)})),g.addEventListener("click",(function(){return o(q)})),w.addEventListener("click",(function(){return o(P)})),O.addEventListener("click",(function(){return o(I)})),j.addEventListener("click",(function(){return o(C)})),h.addEventListener("click",c),q.addEventListener("click",c),P.addEventListener("click",c),C.addEventListener("click",c),I.addEventListener("click",c),h.addEventListener("submit",(function(e){var t,n;e.preventDefault(),y.textContent=T.value,m.textContent=D.value,k.textContent="Сохранение...",(t=T.value,n=D.value,fetch("".concat(l.baseUrl,"/users/me"),{method:"PATCH",headers:l.headers,body:JSON.stringify({name:t,about:n})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))).then((function(e){console.log(e),k.textContent="Сохранить",o(h),G(b)})).catch((function(e){console.log(e),o(h),G(b)}))})),q.addEventListener("submit",(function(t){var n,r;t.preventDefault(),L.textContent="Сохранение...",(n=N.value,r=z.value,fetch("".concat(l.baseUrl,"/cards"),{method:"POST",headers:l.headers,body:JSON.stringify({name:n,link:r})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))).then((function(t){console.log(t),console.log(t._id);var n=e(t.name,t.link,F,t._id,K,t.likes.length,$);console.log(n),H(n),L.textContent="Сохранить",o(q),G(E)})).catch((function(e){console.log(e),o(q),G(E)}))})),I.addEventListener("submit",(function(e){e.preventDefault();var t=I.id;I.id="",function(e){return fetch("".concat(l.baseUrl,"/cards/").concat(e),{method:"DELETE",headers:l.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))}(t).then((function(e){console.log(e),function(e){document.getElementById(e).remove()}(t),o(I)})).catch((function(e){console.log(e),o(I)}))})),C.addEventListener("submit",(function(e){var t;e.preventDefault(),A.textContent="Сохранение...",(t=J.value,fetch("".concat(l.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:l.headers,body:JSON.stringify({avatar:t})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))).then((function(e){console.log(e),_.style.backgroundImage="url(".concat(J.value,")"),A.textContent="Сохранить",o(C),G(x)})).catch((function(e){console.log(e),o(C),G(x)}))})),function(e){Array.from(document.querySelectorAll(e.formSelector)).forEach((function(t){t.addEventListener("submit",(function(e){e.preventDefault()})),function(e,t){var n=Array.from(t.querySelectorAll(e.inputSelector)),o=t.querySelector(e.submitButtonSelector);a(e,n,o),n.forEach((function(r){r.addEventListener("input",(function(){!function(e,t,n){/^[a-zA-zёЁа-яА-я\-\s]{1,}$/.test(n.value)||"text"!=n.type?n.validity.valid?function(e,t,n){var o=t.querySelector(".".concat(n.id,"-error"));n.classList.remove(e.inputErrorClass),o.classList.remove(e.errorClass),o.textContent=""}(e,t,n):i(e,t,n,n.validationMessage):i(e,t,n,n.dataset.errorMessage)}(e,t,r),a(e,n,o)}))}))}(e,t)}))}(M),Promise.all([fetch("".concat(l.baseUrl,"/users/me"),{headers:l.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})),fetch("".concat(l.baseUrl,"/cards"),{headers:l.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))]).then((function(n){var o,r,c=(r=2,function(e){if(Array.isArray(e))return e}(o=n)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var o,r,c,u,i=[],a=!0,l=!1;try{if(c=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;a=!1}else for(;!(a=(o=c.call(n)).done)&&(i.push(o.value),i.length!==t);a=!0);}catch(e){l=!0,r=e}finally{try{if(!a&&null!=n.return&&(u=n.return(),Object(u)!==u))return}finally{if(l)throw r}}return i}}(o,r)||function(e,t){if(e){if("string"==typeof e)return s(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?s(e,t):void 0}}(o,r)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),u=c[0],i=c[1];y.textContent=u.name,m.textContent=u.about,_.style.backgroundImage="url(".concat(u.avatar,")"),i.reverse().forEach((function(n){var o=e(n.name,n.link,F,n._id,K,n.likes.length,$);o.id=n._id,n.owner._id!==u._id&&o.querySelector(".card__delete-button").remove(),H(o),n.likes.forEach((function(e){e._id===u._id&&t(n._id)}))}))})).catch((function(e){console.log(e)}))})();