(()=>{"use strict";var e=document.querySelector(".profile__edit-button"),t=document.querySelector(".profile__add-button"),n=document.querySelector(".profile__avatar_overlay"),r=document.querySelector(".profile__avatar_image"),o=document.querySelector(".profile__title"),c=document.querySelector(".profile__description"),a=document.querySelector(".places__list"),i=document.querySelectorAll(".popup"),u=document.querySelector(".popup_type_edit"),l=document.forms["edit-profile"],s=document.querySelector(".popup_type_new-card"),d=document.forms["new-place"],p=document.querySelector(".popup_type_update-avatar"),f=document.forms["update-avatar"],_=document.querySelector(".popup_type_image"),m=_.querySelector(".popup__caption"),v=_.querySelector(".popup__image"),y=document.querySelector(".popup_type_delete"),h=u.querySelector(".popup__input_type_name"),b=u.querySelector(".popup__input_type_description"),S=s.querySelector(".popup__input_type_card-name"),k=s.querySelector(".popup__input_type_url"),g=p.querySelector(".popup__input_type_url"),q={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"};function C(e){var t=document.querySelector("#card-template").content.querySelector(".card").cloneNode(!0),n=t.querySelector(".card__image"),r=t.querySelector(".card__delete-button"),o=t.querySelector(".card__like-section_like-button"),c=t.querySelector(".card__like-section_likes-counter");return t.querySelector(".card__title").textContent=e.name,t.id=e.cardId,n.setAttribute("src",e.link),n.setAttribute("alt","Картинка карточки: "+e.name),c.textContent=e.like.length,t.id=e.cardId,e.ownerId!==e.userId&&r.remove(),e.like.forEach((function(t){t._id===e.userId&&E(o)})),o.addEventListener("click",(function(){return e.updateLike(e.cardId,o,c)})),r.addEventListener("click",(function(){return e.del(e.cardId)})),n.addEventListener("click",(function(){return e.handleImageClick(e.name,e.link)})),t}function E(e){e.classList.toggle("card__like-section_like-button_is-active")}function L(e){e.classList.toggle("popup_is-opened"),document.addEventListener("keydown",x)}function I(e){e.classList.remove("popup_is-opened"),document.removeEventListener("keydown",x)}function x(e){"Escape"==e.key&&I(document.querySelector(".popup_is-opened"))}function A(e,t){var n=Array.from(t.querySelectorAll(e.inputSelector)),r=t.querySelector(e.submitButtonSelector);n.forEach((function(n){var r=t.querySelector(".".concat(n.id,"-error"));r.classList.remove(e.errorClass),r.textContent="",n.classList.remove(e.inputErrorClass),n.value=""})),j(e,n,r)}function w(e,t,n,r){var o=t.querySelector(".".concat(n.id,"-error"));n.classList.add(e.inputErrorClass),o.classList.add(e.errorClass),o.textContent=r}function U(e,t){t.disabled=!0,t.classList.add(e.inactiveButtonClass)}function j(e,t,n){!function(e){return e.some((function(e){return!e.validity.valid}))}(t)?function(e,t){t.disabled=!1,t.classList.remove(e.inactiveButtonClass)}(e,n):U(e,n)}function B(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}function O(e,t){return fetch(e,t).then(B)}function T(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"Сохранить",r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"Сохранение...";t.textContent=e?r:n}function P(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"Сохранение...";t.preventDefault();var o=t.submitter,c=o.textContent;T(!0,o,c,r),e().then((function(){n&&t.target.reset()})).catch((function(e){console.error("Ошибка: ".concat(e))})).finally((function(){T(!1,o,c)}))}var D={baseUrl:"https://nomoreparties.co/v1/wff-cohort-4",headers:{authorization:"c0edb41f-ba4d-40ed-827b-6ec0b8b823cf","Content-Type":"application/json"}};function N(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function J(e){a.insertBefore(e,a.firstChild)}function M(e,t){v.src=t,v.alt="Картинка карточки: "+e,m.textContent=e,L(_)}function z(e){y.id=e,L(y)}function H(e,t,n){t.classList.contains("card__like-section_like-button_is-active")?function(e){return O("".concat(D.baseUrl,"/cards/likes/").concat(e),{method:"DELETE",headers:D.headers})}(e).then((function(e){n.textContent=e.likes.length,E(t)})).catch(console.error):function(e){return O("".concat(D.baseUrl,"/cards/likes/").concat(e),{method:"PUT",headers:D.headers})}(e).then((function(e){n.textContent=e.likes.length,E(t)})).catch(console.error)}e.addEventListener("click",(function(){A(q,l),h.value=o.textContent,b.value=c.textContent,L(u)})),t.addEventListener("click",(function(){L(s),A(q,d)})),n.addEventListener("click",(function(){L(p),A(q,f)})),u.addEventListener("submit",(function(e){P((function(){return(e=h.value,t=b.value,O("".concat(D.baseUrl,"/users/me"),{method:"PATCH",headers:D.headers,body:JSON.stringify({name:e,about:t})})).then((function(e){o.textContent=e.name,c.textContent=e.about,I(u)}));var e,t}),e)})),s.addEventListener("submit",(function(e){P((function(){return(e=S.value,t=k.value,O("".concat(D.baseUrl,"/cards"),{method:"POST",headers:D.headers,body:JSON.stringify({name:e,link:t})})).then((function(e){J(C({name:e.name,link:e.link,cardId:e._id,like:e.likes,ownerId:e.owner._id,userId:e.owner._id,del:z,updateLike:H,handleImageClick:M})),I(s)}));var e,t}),e)})),y.addEventListener("submit",(function(e){var t=y.id;y.id="",P((function(){return function(e){return O("".concat(D.baseUrl,"/cards/").concat(e),{method:"DELETE",headers:D.headers})}(t).then((function(){!function(e){document.getElementById(e).remove()}(t),I(y)}))}),e,!1)})),p.addEventListener("submit",(function(e){P((function(){return(e=g.value,O("".concat(D.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:D.headers,body:JSON.stringify({avatar:e})})).then((function(e){r.style.backgroundImage="url(".concat(e.avatar,")"),I(p)}));var e}),e)})),i.forEach((function(e){e.addEventListener("mousedown",(function(t){t.target.classList.contains("popup_is-opened")&&I(e),t.target.classList.contains("popup__close")&&I(e)}))})),function(e){Array.from(document.querySelectorAll(e.formSelector)).forEach((function(t){t.addEventListener("submit",(function(e){e.preventDefault()})),function(e,t){var n=Array.from(t.querySelectorAll(e.inputSelector)),r=t.querySelector(e.submitButtonSelector);j(e,n,r),t.addEventListener("reset",(function(){U(e,r)})),n.forEach((function(o){o.addEventListener("input",(function(){!function(e,t,n){/^[a-zA-ZёЁа-яА-Я\-\s]{1,}$/.test(n.value)||"text"!=n.type?n.validity.valid?function(e,t,n){var r=t.querySelector(".".concat(n.id,"-error"));n.classList.remove(e.inputErrorClass),r.classList.remove(e.errorClass),r.textContent=""}(e,t,n):w(e,t,n,n.validationMessage):w(e,t,n,n.dataset.errorMessage)}(e,t,o),j(e,n,r)}))}))}(e,t)}))}(q),Promise.all([O("".concat(D.baseUrl,"/users/me"),{headers:D.headers}),O("".concat(D.baseUrl,"/cards"),{headers:D.headers})]).then((function(e){var t,n,a=(n=2,function(e){if(Array.isArray(e))return e}(t=e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,c,a,i=[],u=!0,l=!1;try{if(c=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;u=!1}else for(;!(u=(r=c.call(n)).done)&&(i.push(r.value),i.length!==t);u=!0);}catch(e){l=!0,o=e}finally{try{if(!u&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(l)throw o}}return i}}(t,n)||function(e,t){if(e){if("string"==typeof e)return N(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?N(e,t):void 0}}(t,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),i=a[0],u=a[1];o.textContent=i.name,c.textContent=i.about,r.style.backgroundImage="url(".concat(i.avatar,")"),u.reverse().forEach((function(e){J(C({name:e.name,link:e.link,cardId:e._id,like:e.likes,ownerId:e.owner._id,userId:i._id,del:z,updateLike:H,handleImageClick:M}))}))})).catch(console.error)})();